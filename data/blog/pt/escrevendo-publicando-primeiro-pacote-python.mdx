---
title: 'Escrevendo e publicando seu primeiro pacote em Python'
date: '2024-02-27'
language: pt
tags: ['python', 'package', 'pypi', 'open-source', 'tutorial']
authors: ['lucas-andrade']
draft: false
summary: 'Tentando criar sua primeira biblioteca p√∫blica e tendo dificuldades? Vem comigo que vou te explicar!'
images: ['/static/images/python-package.png']
---

Recentemente, escrevi um pacote em Python que analisa alguns dados de uma url e retorna uma rela√ß√£o com esses dados:

```json
{ "load_time":"488.837125ms","http_requests_count":3,"page_size":53 }
```

Esses s√£o: Tempo de carregamento, contagem de requisi√ß√µes HTTP externas que s√£o feitas dentro da p√°gina e o tamanho da p√°gina, em Bytes.

**Voc√™ pode conferir e usar o pacote [aqui](https://github.com/olucasandrade/py-url-analyzer)**.

Mas eu confesso que sabia muito pouco sobre o processo de publica√ß√£o de uma biblioteca em Python, e tive dificuldade em entender exatamente o passo a passo procurando umas refer√™ncias nas documenta√ß√µes.

Mas depois de um tempinho‚Ä¶ Consegui! O pacote est√° publicado e est√° no Pypi, pronto pra ser instalado por qualquer um com o pip install. Mas como √© o processo de publica√ß√£o? Isso √© o que vamos ver nesse artigo!

## Mas o que √© esse tal de PyPi?

O Python Package Index (PyPI) √© um reposit√≥rio online que serve como um ponto central para a distribui√ß√£o de pacotes Python. Ele abriga uma ampla variedade de bibliotecas, frameworks e ferramentas desenvolvidas pela comunidade Python. Os desenvolvedores podem acessar o PyPI para encontrar e instalar pacotes prontos para uso em seus projetos, facilitando significativamente o processo de desenvolvimento de software em Python. Os pacotes que est√£o no PyPi s√£o baixados justamente usando o `pip`.

## E como funciona o pip?

O pip √© a ferramenta padr√£o de gerenciamento de pacotes para Python, e sua fun√ß√£o principal √© simplificar a instala√ß√£o e gerenciamento de pacotes Python. Funciona de maneira simples: os usu√°rios podem usar o pip atrav√©s da linha de comando do terminal ou prompt de comando do sistema operacional. Comandos como `pip install` seguido do nome do pacote instalam o pacote especificado. O pip ent√£o automaticamente baixa o pacote do PyPI (ou de outros reposit√≥rios especificados) e o instala no ambiente Python local. Al√©m disso, o pip pode ser usado para desinstalar pacotes (`pip uninstall`), listar pacotes instalados (`pip list`), atualizar pacotes para as vers√µes mais recentes, entre outras funcionalidades, simplificando o processo de gerenciamento de depend√™ncias em projetos Python.

## Publicando seu pacote

### #1: Criando o pacote

Antes de tudo, claro, voc√™ precisa ter seu pacote no esquema pra ser usado por outros projetos. Comecei criando uma pasta `py-url-analyzer`. Nela, ap√≥s criar um ambiente virtual e instalar as bibliotecas necess√°rias (n√£o √© o foco do artigo, ent√£o vou deixar [esse artigo externo sobre](https://docs.python.org/pt/3/library/venv.html)), eu criei um `requirements.txt` com o seguinte comando:

```bash
pip freeze > requirements.txt
```

Com isso, vamos ter um arquivo definindo todas as bibliotecas necess√°rias para o projeto. Isso vai ser √∫til para quem acessar o projeto e tamb√©m para o setup.

A partir da√≠, criei uma pasta `url_analyzer` com um arquivo `__init__.py`, que vai conter o m√©todo do pacote. Logo, por hora, o projeto ficou assim:

```
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ LICENSE
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ test_url_analyzer.py
‚îú‚îÄ‚îÄ url_analyzer
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
```

Lembrando que seguir essa arquitetura de pastas e arquivos √© completamente opcional. Como o Python √© bem flex√≠vel, voc√™ pode organizar da maneira que achar melhor.

### #2: Configurando o pacote

Para configurar o pacote de modo que seja poss√≠vel publicar no PyPi futuramente, precisamos criar um arquivo `setup.py`, que vai conter as informa√ß√µes necess√°rias para o nosso pacote ser algo a ser publicado.

Apesar de existir um template, n√£o possui uma maneira de gerar um por padr√£o, como um `package.json`, por exemplo. Ent√£o √© necess√°rio ser preenchido diretamente. Mas, de maneira geral, s√£o informa√ß√µes simples. Essa √© a documenta√ß√£o do padr√£o do `setup.py`, e esse √© meu arquivo que pode ser √∫til pra se basear:

```python
from setuptools import setup, find_packages

setup(
    name='py-url-analyzer',
    version='0.0.2',
    packages=find_packages(),
    author='Lucas Andrade',
    author_email='lafdesouza2002@gmail.com',
    description='A simple URL analyzer',
    long_description=open('README.md').read(),
    long_description_content_type='text/markdown',
    url='https://github.com/olucasandrade/py-url-analyzer',
    install_requires=[
        'beautifulsoup4',
        'certifi',
        'charset-normalizer',
        'idna',
        'requests',
        'soupsieve',
        'urllib3',
    ],
    classifiers=[
        'Programming Language :: Python :: 3',
        'License :: OSI Approved :: MIT License',
        'Operating System :: OS Independent',
    ],
)
```

A partir daqui, pra gerar o pacote de distribui√ß√£o do seu projeto Python, voc√™ precisa executar o seguinte comando no terminal

```bash
python setup.py sdist
```

Este comando ir√° criar um arquivo compactado (.tar.gz ou .zip) que cont√©m todos os arquivos necess√°rios para instalar o seu pacote em outros sistemas.

### #3: Criando uma conta e um token no Pypi

Agora, precisamos acessar o site do PyPI (https://pypi.org/) e criar uma conta (ou fazer login, caso j√° tenha). Em seguida, siga estes passos para criar um token. Isso vai ser necess√°rio para a publica√ß√£o:

- Acesse https://pypi.org/manage/account/token/
- Insira um nome para o token.
- Clique no bot√£o "Create Token".
- Copie o token gerado, pois voc√™ precisar√° dele em breve.

### #4: Subindo o pacote no Pypi

Pra subir o pacote, vamos usar a lib `twine`, que √© uma ferramenta open-source para publicar pacotes Python no PyPI.

Primeiro, vamos intalar o `twine`:

```bash
pip install twine
```

Agora navegue at√© a pasta do seu projeto no terminal e execute o seguinte comando:

```bash
twine upload dist/*
```

O Twine solicitar√° seu nome de usu√°rio e senha do PyPI. Em vez disso, voc√™ pode usar o token que gerou anteriormente:

- Digite `__token__` no prompt de nome de usu√°rio.
- Digite seu token no prompt de senha.

Com isso, o upload deve ser bem sucedido e voc√™ pode verificar ou acessando o projeto diretamente com:

```
https://pypi.org/project/<nome-do-projeto>/
```

Ou simplesmente procurando seu projeto em https://pypi.org/manage/projects/.

## Dicas

Pronto! Com isso, seu pacote est√° pronto pra ser instalado em qualquer projeto externo que seja.

### Dicas importantes:

- **Certifique-se de que o seu c√≥digo est√° limpo e bem documentado antes de publicar**: Antes de publicar seu pacote, √© crucial garantir que seu c√≥digo esteja organizado, leg√≠vel e bem documentado. Certifique-se de seguir as melhores pr√°ticas de codifica√ß√£o e comentar o c√≥digo de forma clara e concisa. Isso n√£o apenas facilitar√° a compreens√£o do seu c√≥digo por outros desenvolvedores, mas tamb√©m ajudar√° na manuten√ß√£o e na identifica√ß√£o de poss√≠veis problemas.

- **Use uma vers√£o sem√¢ntica para o seu pacote**: Adote uma abordagem de versionamento sem√¢ntico ao atribuir vers√µes ao seu pacote. Isso significa que voc√™ deve seguir um padr√£o consistente de incremento de vers√µes com base nas mudan√ßas feitas no seu c√≥digo. Recomenda-se o formato "MAJOR.MINOR.PATCH", onde "MAJOR" √© incrementado para mudan√ßas incompat√≠veis, "MINOR" para adi√ß√µes compat√≠veis com vers√µes anteriores e "PATCH" para corre√ß√µes de bugs compat√≠veis com vers√µes anteriores.

- **Inclua um README.md com informa√ß√µes sobre o seu pacote, como instala√ß√£o, uso e exemplos**: Um arquivo README.md √© essencial para fornecer informa√ß√µes detalhadas sobre o seu pacote para os usu√°rios. Certifique-se de incluir instru√ß√µes claras sobre como instalar o seu pacote usando pip ou outras ferramentas de gerenciamento de pacotes, como usar suas funcionalidades e exemplos de c√≥digo para ajudar os usu√°rios a come√ßar.

- **Teste a publica√ß√£o primeiramente no TestPyPi**: Antes de publicar seu pacote no PyPI oficial, √© altamente recomend√°vel testar a publica√ß√£o no TestPyPI. O TestPyPI √© um ambiente de teste para pacotes Python, onde voc√™ pode simular o processo de publica√ß√£o sem afetar o reposit√≥rio principal. Isso permite que voc√™ verifique se tudo est√° configurado corretamente e se n√£o h√° problemas de empacotamento ou instala√ß√£o antes de fazer a publica√ß√£o oficial. O processo √© o mesmo do PyPi, com a √∫nica diferen√ßa sendo o upload especificando o reposit√≥rio:

```bash
twine upload --repository testpypi dist/*
```

√â tamb√©m preciso criar uma conta no https://test.pypi.org/.

---

Espero que tenha gostado e te vejo no pr√≥ximo artigo! üëã


